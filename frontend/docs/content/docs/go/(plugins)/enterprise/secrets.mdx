---
title: Secrets Management
description: Encrypted secrets storage with versioning, rollback, and Forge ConfigSource integration
---

import { Callout } from 'fumadocs-ui/components/callout'
import { Tab, Tabs } from 'fumadocs-ui/components/tabs'

# Secrets Plugin

The Secrets plugin provides encrypted secrets and configuration management. Secrets are stored with AES-256-GCM encryption, support versioning with rollback, hierarchical path-based access, and can be used as a Forge ConfigSource for application configuration.

<Callout type="warn">
The `AUTHSOME_SECRETS_MASTER_KEY` environment variable must be set. This key is used for encrypting and decrypting all secrets. Losing this key means losing access to all stored secrets.
</Callout>

## Features

- **Encrypted Storage** - AES-256-GCM encryption for all secret values
- **Versioning** - Version history with rollback support
- **Hierarchical Paths** - Path-based organization (e.g., `app/database/password`)
- **Forge ConfigSource** - Use secrets as a Forge configuration source
- **RBAC Access Control** - Role-based access to secrets
- **Audit Logging** - Track reads and writes with configurable retention
- **Tree View** - Hierarchical view of all secrets
- **Statistics** - Secret count, version stats
- **Dashboard Extension** - UI for secret management with reveal timeout
- **Auto Cleanup** - Automatic cleanup of old versions

## Quick Start

### Installation

```go
import (
    "github.com/xraph/authsome"
    "github.com/xraph/authsome/plugins/secrets"
)

auth := authsome.New(
    authsome.WithDatabase(db),
    authsome.WithPlugins(
        secrets.NewPlugin(),
    ),
)
```

### Configuration

```yaml
auth:
  plugins:
    secrets:
      encryption:
        masterKey: "${AUTHSOME_SECRETS_MASTER_KEY}"
        rotateKeyAfter: "8760h"  # 365 days
        testOnStartup: true

      configSource:
        enabled: false
        prefix: ""
        refreshInterval: "5m"
        autoRefresh: true
        priority: 100

      access:
        requireAuthentication: true
        requireRbac: true
        allowApiAccess: true
        allowDashboardAccess: true

      versioning:
        maxVersions: 50
        retentionDays: 90
        autoCleanup: true
        cleanupInterval: "24h"

      audit:
        enableAccessLog: true
        logReads: false
        logWrites: true
        retentionDays: 365
```

## API Reference

### Secret Management

```http
POST   /secrets                          # Create secret
GET    /secrets                          # List secrets
GET    /secrets/:id                      # Get secret metadata
GET    /secrets/:id/value                # Get decrypted value
PUT    /secrets/:id                      # Update secret
DELETE /secrets/:id                      # Delete secret
GET    /secrets/path/*path               # Get secret by path
GET    /secrets/stats                    # Get statistics
GET    /secrets/tree                     # Get hierarchical tree view
```

### Version Management

```http
GET    /secrets/:id/versions             # List versions
POST   /secrets/:id/rollback/:version    # Rollback to version
```

### Create Secret Example

```bash
curl -X POST https://auth.yourdomain.com/secrets \
  -H "Authorization: Bearer ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Database Password",
    "path": "production/database/password",
    "value": "super-secret-password",
    "description": "Production database password"
  }'
```

### Get Secret by Path

```bash
curl https://auth.yourdomain.com/secrets/path/production/database/password \
  -H "Authorization: Bearer ADMIN_TOKEN"
```

### Rollback to Version

```bash
curl -X POST https://auth.yourdomain.com/secrets/{id}/rollback/3 \
  -H "Authorization: Bearer ADMIN_TOKEN"
```

## Forge ConfigSource Integration

When enabled, secrets can be used as a configuration source in Forge:

```yaml
auth:
  plugins:
    secrets:
      configSource:
        enabled: true
        prefix: "secrets"
        autoRefresh: true
        refreshInterval: "5m"
```

Secrets stored at path `database/host` become accessible as Forge config key `secrets.database.host`.

## RBAC Roles

The plugin registers:
- `secrets_admin` - Full access to all secrets
- `secrets_viewer` - Read-only access to secrets

## Route Summary

| Method | Path | Description |
|---|---|---|
| `POST` | `/secrets` | Create secret |
| `GET` | `/secrets` | List secrets |
| `GET` | `/secrets/stats` | Get statistics |
| `GET` | `/secrets/tree` | Hierarchical tree view |
| `GET` | `/secrets/path/*path` | Get by path |
| `GET` | `/secrets/:id` | Get metadata |
| `GET` | `/secrets/:id/value` | Get decrypted value |
| `PUT` | `/secrets/:id` | Update secret |
| `DELETE` | `/secrets/:id` | Delete secret |
| `GET` | `/secrets/:id/versions` | List versions |
| `POST` | `/secrets/:id/rollback/:version` | Rollback to version |

## Resources

- [Secrets Plugin Source](https://github.com/xraph/authsome/tree/main/plugins/secrets)
