plugin_id: twofa
version: 1.0.0
routes:
    - name: Enable
      method: POST
      path: /2fa/enable
    - name: Verify
      method: POST
      path: /2fa/verify
      response_type: StatusResponse
    - name: Disable
      method: POST
      path: /2fa/disable
      response_type: StatusResponse
    - name: GenerateBackupCodes
      method: POST
      path: /2fa/generate-backup-codes
      response:
        codes: '[]string!'
      response_type: CodesResponse
    - name: SendOTP
      description: SendOTP triggers generation of an OTP code for a user (returns code in response for dev/testing)
      method: POST
      path: /2fa/send-otp
      response:
        code: string!
        status: string!
      response_type: OTPSentResponse
    - name: Status
      description: Status returns whether 2FA is enabled and whether the device is trusted
      method: POST
      path: /2fa/status
      response:
        enabled: bool!
        method: string!
        trusted: bool!
      response_type: TwoFAStatusResponse
types:
    - name: DisableRequest
      fields:
        user_id: string!
    - name: SendOTPRequest
      fields:
        user_id: string!
    - name: CodesResponse
      fields:
        codes: '[]string!'
    - name: TwoFASendOTPResponse
      fields:
        code: string!
        status: string!
    - name: VerifyRequest2FA
      fields:
        code: string!
        device_id: string!
        remember_device: bool!
        user_id: string!
    - name: GetStatusRequest
      fields:
        device_id: string!
        user_id: string!
    - name: OTPSentResponse
      fields:
        code: string!
        status: string!
    - name: TwoFAStatusResponse
      fields:
        enabled: bool!
        method: string!
        trusted: bool!
    - name: TwoFAErrorResponse
      fields:
        error: string!
    - name: TwoFAEnableResponse
      fields:
        status: string!
        totp_uri: string!
    - name: TwoFAStatusDetailResponse
      fields:
        enabled: bool!
        method: string!
        trusted: bool!
    - name: VerifyRequest
      fields:
        "": string
    - name: EnableRequest2FA
      fields:
        method: string!
        user_id: string!
    - name: RegenerateCodesRequest
      fields:
        count: int!
        user_id: string!
    - name: EnableResponse
      fields:
        status: string!
        totp_uri: string!
    - name: TwoFABackupCodesResponse
      fields:
        codes: '[]string!'
    - name: Service
      fields:
        "": Config
    - name: Status
      fields:
        "": bool
    - name: TOTPSecret
      fields:
        "": string
    - name: Handler
      fields:
        "": '*Service'
    - name: Plugin
      fields:
        "": Config
    - name: Config
      fields:
        backupCodeCount: int!
        backupCodeLength: int!
        maxOtpAttempts: int!
        otpExpiryMinutes: int!
        requireFor2FA: bool!
        totpDigits: int!
        totpIssuer: string!
        totpPeriod: int!
        trustedDeviceDays: int!
    - name: EnableRequest
      fields:
        "": string
