plugin_id: mfa
version: 1.0.0
routes:
    - name: EnrollFactor
      description: EnrollFactor handles POST /mfa/factors/enroll
      method: POST
      path: /mfa/factors/enroll
      request:
        metadata: '!'
        name: string!
        priority: FactorPriority!
        type: FactorType!
      response:
        factorId: xid.ID!
        provisioningData: '!'
        status: FactorStatus!
        type: FactorType!
      request_type: FactorEnrollmentRequest
      response_type: FactorEnrollmentResponse
    - name: ListFactors
      description: ListFactors handles GET /mfa/factors
      method: GET
      path: /mfa/factors
      response:
        count: int!
        factors: '!'
      response_type: FactorsResponse
    - name: GetFactor
      description: GetFactor handles GET /mfa/factors/:id
      method: GET
      path: /mfa/factors/:id
      response:
        '-': string!
        createdAt: time.Time!
        expiresAt: '*time.Time!'
        id: xid.ID!
        lastUsedAt: '*time.Time!'
        metadata: '!'
        name: string!
        priority: FactorPriority!
        status: FactorStatus!
        type: FactorType!
        updatedAt: time.Time!
        userId: xid.ID!
        verifiedAt: '*time.Time!'
      response_type: Factor
    - name: UpdateFactor
      description: UpdateFactor handles PUT /mfa/factors/:id
      method: PUT
      path: /mfa/factors/:id
      response_type: MessageResponse
    - name: DeleteFactor
      description: DeleteFactor handles DELETE /mfa/factors/:id
      method: DELETE
      path: /mfa/factors/:id
      response_type: MessageResponse
    - name: VerifyFactor
      description: VerifyFactor handles POST /mfa/factors/:id/verify
      method: POST
      path: /mfa/factors/:id/verify
      response_type: MessageResponse
    - name: InitiateChallenge
      description: InitiateChallenge handles POST /mfa/challenge
      method: POST
      path: /mfa/challenge
      request:
        context: string!
        factorTypes: '[]FactorType!'
        metadata: '!'
        userId: xid.ID!
      response:
        availableFactors: '[]FactorInfo!'
        challengeId: xid.ID!
        expiresAt: time.Time!
        factorsRequired: int!
        sessionId: xid.ID!
      request_type: ChallengeRequest
      response_type: ChallengeResponse
    - name: VerifyChallenge
      description: VerifyChallenge handles POST /mfa/verify
      method: POST
      path: /mfa/verify
      request:
        challengeId: xid.ID!
        code: string!
        data: '!'
        deviceInfo: '*DeviceInfo!'
        factorId: xid.ID!
        rememberDevice: bool!
      response:
        expiresAt: '*time.Time!'
        factorsRemaining: int!
        sessionComplete: bool!
        success: bool!
        token: string!
      request_type: VerificationRequest
      response_type: VerificationResponse
    - name: GetChallengeStatus
      description: GetChallengeStatus handles GET /mfa/challenge/:id
      method: GET
      path: /mfa/challenge/:id
      response:
        completedAt: '*time.Time!'
        expiresAt: time.Time!
        factorsRemaining: int!
        factorsRequired: int!
        factorsVerified: int!
        sessionId: xid.ID!
        status: string!
      response_type: ChallengeStatusResponse
    - name: TrustDevice
      description: TrustDevice handles POST /mfa/devices/trust
      method: POST
      path: /mfa/devices/trust
      request:
        deviceId: string!
        metadata: '!'
        name: string!
      request_type: DeviceInfo
      response_type: MessageResponse
    - name: ListTrustedDevices
      description: ListTrustedDevices handles GET /mfa/devices
      method: GET
      path: /mfa/devices
      response:
        count: int!
        devices: '!'
      response_type: DevicesResponse
    - name: RevokeTrustedDevice
      description: RevokeTrustedDevice handles DELETE /mfa/devices/:id
      method: DELETE
      path: /mfa/devices/:id
      response_type: MessageResponse
    - name: GetStatus
      description: GetStatus handles GET /mfa/status
      method: GET
      path: /mfa/status
      response:
        enabled: bool!
        enrolledFactors: '[]FactorInfo!'
        gracePeriod: '*time.Time!'
        policyActive: bool!
        requiredCount: int!
        trustedDevice: bool!
      response_type: MFAStatus
    - name: GetPolicy
      description: GetPolicy handles GET /mfa/policy
      method: GET
      path: /mfa/policy
      response:
        allowed_factor_types: '[]string!'
        enabled: bool!
        required_factor_count: int!
      response_type: MFAConfigResponse
    - name: AdminUpdatePolicy
      description: |-
        AdminUpdatePolicy handles PUT /mfa/admin/policy
        Updates the MFA policy for an app (admin only)
      method: PUT
      path: /mfa/policy
      response_type: StatusResponse
    - name: AdminResetUserMFA
      description: |-
        AdminResetUserMFA handles POST /mfa/admin/users/:id/reset
        Resets all MFA factors for a user (admin only)
      method: POST
      path: /mfa/users/:id/reset
      response_type: MessageResponse
types:
    - name: MFABypassResponse
      fields:
        expiresAt: time.Time!
        id: xid.ID!
        reason: string!
        userId: xid.ID!
    - name: WebAuthnFactorAdapter
      fields:
        "": '*passkey.Service'
    - name: VerifyEnrolledFactorRequest
      fields:
        "": string
        code: string!
        data: '!'
    - name: RevokeTrustedDeviceRequest
      fields:
        "": string
    - name: ChallengeStatusResponse
      fields:
        completedAt: '*time.Time!'
        expiresAt: time.Time!
        factorsRemaining: int!
        factorsRequired: int!
        factorsVerified: int!
        sessionId: xid.ID!
        status: string!
    - name: FactorEnrollmentResponse
      fields:
        factorId: xid.ID!
        provisioningData: '!'
        status: FactorStatus!
        type: FactorType!
    - name: ListFactorsResponse
      fields:
        count: int!
        factors: '[]Factor!'
    - name: TOTPFactorAdapter
      fields:
        "": '*twofa.Service'
    - name: Config
      fields:
        adaptive_mfa: AdaptiveMFAConfig!
        allowed_factor_types: '[]FactorType!'
        backup_codes: BackupCodesConfig!
        challenge_expiry_minutes: int!
        email: EmailConfig!
        enabled: bool!
        grace_period_days: int!
        max_attempts: int!
        rate_limit: RateLimitConfig!
        require_for_all_users: bool!
        required_factor_count: int!
        session_expiry_minutes: int!
        sms: SMSConfig!
        totp: TOTPConfig!
        trusted_devices: TrustedDevicesConfig!
        webauthn: WebAuthnConfig!
    - name: EmailConfig
      fields:
        code_expiry_minutes: int!
        code_length: int!
        enabled: bool!
        provider: string!
        rate_limit: '*RateLimitConfig!'
        template_id: string!
    - name: DevicesResponse
      fields:
        count: int!
        devices: '!'
    - name: SuccessResponse
      fields:
        data: '!'
        message: string!
    - name: RiskFactor
      fields:
        "": float64
    - name: EmailFactorAdapter
      fields:
        "": '*notificationPlugin.Adapter'
    - name: EnrollFactorRequest
      fields:
        metadata: '!'
        name: string!
        priority: FactorPriority!
        type: FactorType!
    - name: MFASession
      fields:
        completedAt: '*time.Time!'
        createdAt: time.Time!
        expiresAt: time.Time!
        factorsRequired: int!
        factorsVerified: int!
        id: xid.ID!
        ipAddress: string!
        metadata: '!'
        riskLevel: RiskLevel!
        sessionToken: string!
        userAgent: string!
        userId: xid.ID!
        verifiedFactors: '[]xid.ID!'
    - name: GetStatusRequest
      fields:
        "": string
    - name: MFAPolicy
      fields:
        adaptiveMfaEnabled: bool!
        allowedFactorTypes: '[]FactorType!'
        createdAt: time.Time!
        gracePeriodDays: int!
        id: xid.ID!
        lockoutDurationMinutes: int!
        maxFailedAttempts: int!
        organizationId: xid.ID!
        requiredFactorCount: int!
        requiredFactorTypes: '[]FactorType!'
        stepUpRequired: bool!
        trustedDeviceDays: int!
        updatedAt: time.Time!
    - name: BackupCodeFactorAdapter
      fields:
        "": '*twofa.Service'
    - name: BaseFactorAdapter
      fields:
        "": bool
    - name: Handler
      fields:
        "": '*Service'
    - name: UpdateFactorRequest
      fields:
        "": string
        metadata: '!'
        name: '*string!'
        priority: '*FactorPriority!'
        status: '*FactorStatus!'
    - name: MFAPolicyResponse
      fields:
        allowedFactorTypes: '[]string!'
        appId: xid.ID!
        enabled: bool!
        gracePeriodDays: int!
        id: xid.ID!
        organizationId: '*xid.ID!'
        requiredFactorCount: int!
    - name: RiskAssessment
      fields:
        factors: '[]string!'
        level: RiskLevel!
        metadata: '!'
        recommended: '[]FactorType!'
        score: float64!
    - name: Plugin
      fields:
        "": '*bun.DB'
    - name: DeleteFactorRequest
      fields:
        "": string
    - name: TrustDeviceRequest
      fields:
        deviceId: string!
        metadata: '!'
        name: string!
    - name: Factor
      fields:
        '-': string!
        createdAt: time.Time!
        expiresAt: '*time.Time!'
        id: xid.ID!
        lastUsedAt: '*time.Time!'
        metadata: '!'
        name: string!
        priority: FactorPriority!
        status: FactorStatus!
        type: FactorType!
        updatedAt: time.Time!
        userId: xid.ID!
        verifiedAt: '*time.Time!'
    - name: SMSFactorAdapter
      fields:
        "": '*phone.Service'
    - name: TOTPConfig
      fields:
        algorithm: string!
        digits: int!
        enabled: bool!
        issuer: string!
        period: int!
        window_size: int!
    - name: RateLimitConfig
      fields:
        enabled: bool!
        lockout_minutes: int!
        max_attempts: int!
        window_minutes: int!
    - name: FactorsResponse
      fields:
        count: int!
        factors: '!'
    - name: TrustedDevice
      fields:
        createdAt: time.Time!
        deviceId: string!
        expiresAt: time.Time!
        id: xid.ID!
        ipAddress: string!
        lastUsedAt: '*time.Time!'
        metadata: '!'
        name: string!
        userAgent: string!
        userId: xid.ID!
    - name: RateLimiter
      fields:
        "": '*repository.MFARepository'
    - name: InitiateChallengeRequest
      fields:
        context: string!
        factorTypes: '[]FactorType!'
        metadata: '!'
    - name: UpdatePolicyRequest
      fields:
        adaptiveMfaEnabled: '*bool!'
        allowedFactorTypes: '[]FactorType!'
        gracePeriodDays: '*int!'
        lockoutDurationMinutes: '*int!'
        maxFailedAttempts: '*int!'
        requiredFactorCount: '*int!'
        requiredFactorTypes: '[]FactorType!'
        stepUpRequired: '*bool!'
        trustedDeviceDays: '*int!'
    - name: ResetUserMFAResponse
      fields:
        devicesRevoked: int!
        factorsReset: int!
        message: string!
        success: bool!
    - name: WebAuthnConfig
      fields:
        attestation_preference: string!
        authenticator_selection: '!'
        enabled: bool!
        rp_display_name: string!
        rp_id: string!
        rp_origins: '[]string!'
        timeout: int!
    - name: ListTrustedDevicesResponse
      fields:
        count: int!
        devices: '[]TrustedDevice!'
    - name: MFAConfigResponse
      fields:
        allowed_factor_types: '[]string!'
        enabled: bool!
        required_factor_count: int!
    - name: GetChallengeStatusRequest
      fields:
        "": string
    - name: VerificationResponse
      fields:
        expiresAt: '*time.Time!'
        factorsRemaining: int!
        sessionComplete: bool!
        success: bool!
        token: string!
    - name: MFAStatus
      fields:
        enabled: bool!
        enrolledFactors: '[]FactorInfo!'
        gracePeriod: '*time.Time!'
        policyActive: bool!
        requiredCount: int!
        trustedDevice: bool!
    - name: AdaptiveMFAConfig
      fields:
        enabled: bool!
        factor_ip_reputation: bool!
        factor_location_change: bool!
        factor_new_device: bool!
        factor_velocity: bool!
        location_change_risk: float64!
        new_device_risk: float64!
        require_step_up_threshold: float64!
        risk_threshold: float64!
        velocity_risk: float64!
    - name: GetFactorRequest
      fields:
        "": string
    - name: ErrorResponse
      fields:
        code: string!
        details: '!'
        error: string!
    - name: ChallengeRequest
      fields:
        context: string!
        factorTypes: '[]FactorType!'
        metadata: '!'
        userId: xid.ID!
    - name: AdminPolicyRequest
      fields:
        allowedTypes: '[]string!'
        enabled: bool!
        gracePeriod: int!
        requiredFactors: int!
    - name: ListFactorsRequest
      fields:
        "": bool
    - name: RiskEngine
      fields:
        "": '*repository.MFARepository'
    - name: ResetUserMFARequest
      fields:
        "": string
        reason: string!
    - name: Service
      fields:
        "": '*notificationPlugin.Adapter'
    - name: FactorEnrollmentRequest
      fields:
        metadata: '!'
        name: string!
        priority: FactorPriority!
        type: FactorType!
    - name: TrustedDevicesConfig
      fields:
        default_expiry_days: int!
        enabled: bool!
        max_devices_per_user: int!
        max_expiry_days: int!
    - name: FactorAdapterRegistry
      fields:
        "": ""
    - name: AdminBypassRequest
      fields:
        duration: int!
        reason: string!
        userId: xid.ID!
    - name: GetChallengeStatusResponse
      fields:
        attempts: int!
        availableFactors: '[]FactorInfo!'
        challengeId: xid.ID!
        factorsRequired: int!
        factorsVerified: int!
        maxAttempts: int!
        status: ChallengeStatus!
    - name: BackupCodesConfig
      fields:
        allow_reuse: bool!
        count: int!
        enabled: bool!
        format: string!
        length: int!
    - name: RiskContext
      fields:
        "": string
    - name: Challenge
      fields:
        '-': string!
        attempts: int!
        createdAt: time.Time!
        expiresAt: time.Time!
        factorId: xid.ID!
        id: xid.ID!
        ipAddress: string!
        maxAttempts: int!
        metadata: '!'
        status: ChallengeStatus!
        type: FactorType!
        userAgent: string!
        userId: xid.ID!
        verifiedAt: '*time.Time!'
    - name: FactorVerificationRequest
      fields:
        code: string!
        data: '!'
        factorId: xid.ID!
    - name: VerificationRequest
      fields:
        challengeId: xid.ID!
        code: string!
        data: '!'
        deviceInfo: '*DeviceInfo!'
        factorId: xid.ID!
        rememberDevice: bool!
    - name: SMSConfig
      fields:
        code_expiry_minutes: int!
        code_length: int!
        enabled: bool!
        provider: string!
        rate_limit: '*RateLimitConfig!'
        template_id: string!
    - name: LimitResult
      fields:
        "": int
    - name: FactorInfo
      fields:
        factorId: xid.ID!
        metadata: '!'
        name: string!
        type: FactorType!
    - name: VerifyChallengeRequest
      fields:
        challengeId: xid.ID!
        code: string!
        data: '!'
        deviceInfo: '*DeviceInfo!'
        factorId: xid.ID!
        rememberDevice: bool!
    - name: ChallengeResponse
      fields:
        availableFactors: '[]FactorInfo!'
        challengeId: xid.ID!
        expiresAt: time.Time!
        factorsRequired: int!
        sessionId: xid.ID!
    - name: DeviceInfo
      fields:
        deviceId: string!
        metadata: '!'
        name: string!
