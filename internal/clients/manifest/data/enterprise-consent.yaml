plugin_id: consent
version: 1.0.0
routes:
    - name: CreateConsent
      description: CreateConsent handles POST /consent/records
      method: POST
      path: /records
      request:
        consentType: string!
        expiresIn: '*int!'
        granted: bool!
        metadata: '!'
        purpose: string!
        userId: string!
        version: string!
      request_type: CreateConsentRequest
    - name: GetConsent
      description: GetConsent handles GET /consent/records/:id
      method: GET
      path: /records/:id
    - name: UpdateConsent
      description: UpdateConsent handles PATCH /consent/records/:id
      method: PUT
      path: /records/:id
      request:
        granted: '*bool!'
        metadata: '!'
        reason: string!
      request_type: UpdateConsentRequest
    - name: RevokeConsent
      description: RevokeConsent handles POST /consent/records/:id/revoke
      method: POST
      path: /revoke/:id
      request:
        granted: '*bool!'
        metadata: '!'
        reason: string!
      request_type: UpdateConsentRequest
      response_type: MessageResponse
    - name: CreateConsentPolicy
      description: CreateConsentPolicy handles POST /consent/policies
      method: POST
      path: /policies
      request:
        consentType: string!
        content: string!
        description: string!
        metadata: '!'
        name: string!
        renewable: bool!
        required: bool!
        validityPeriod: '*int!'
        version: string!
      request_type: CreatePolicyRequest
    - name: GetConsentPolicy
      description: GetConsentPolicy handles GET /consent/policies/:id
      method: GET
      path: /policies/:id
    - name: RecordCookieConsent
      description: RecordCookieConsent handles POST /consent/cookies
      method: POST
      path: /cookies
      request:
        analytics: bool!
        bannerVersion: string!
        essential: bool!
        functional: bool!
        marketing: bool!
        personalization: bool!
        sessionId: string!
        thirdParty: bool!
      request_type: CookieConsentRequest
    - name: GetCookieConsent
      description: GetCookieConsent handles GET /consent/cookies
      method: GET
      path: /cookies
    - name: RequestDataExport
      description: RequestDataExport handles POST /consent/data-exports
      method: POST
      path: /export
      request:
        format: string!
        includeSections: '[]string!'
      request_type: DataExportRequestInput
    - name: GetDataExport
      description: GetDataExport handles GET /consent/data-exports/:id
      method: GET
      path: /export/:id
    - name: DownloadDataExport
      description: DownloadDataExport handles GET /consent/data-exports/:id/download
      method: GET
      path: /export/:id/download
    - name: RequestDataDeletion
      description: RequestDataDeletion handles POST /consent/data-deletions
      method: POST
      path: /deletion
      request:
        deleteSections: '[]string!'
        reason: string!
      request_type: DataDeletionRequestInput
    - name: GetDataDeletion
      description: GetDataDeletion handles GET /consent/data-deletions/:id
      method: GET
      path: /deletion/:id
    - name: ApproveDeletionRequest
      description: ApproveDeletionRequest handles POST /consent/data-deletions/:id/approve (Admin only)
      method: POST
      path: /deletion/:id/approve
      response_type: MessageResponse
    - name: GetPrivacySettings
      description: GetPrivacySettings handles GET /consent/privacy-settings
      method: GET
      path: /settings
    - name: UpdatePrivacySettings
      description: UpdatePrivacySettings handles PATCH /consent/privacy-settings (Admin only)
      method: PUT
      path: /settings
      request:
        allowDataPortability: '*bool!'
        anonymousConsentEnabled: '*bool!'
        autoDeleteAfterDays: '*int!'
        ccpaMode: '*bool!'
        consentRequired: '*bool!'
        contactEmail: string!
        contactPhone: string!
        cookieConsentEnabled: '*bool!'
        cookieConsentStyle: string!
        dataExportExpiryHours: '*int!'
        dataRetentionDays: '*int!'
        deletionGracePeriodDays: '*int!'
        dpoEmail: string!
        exportFormat: '[]string!'
        gdprMode: '*bool!'
        requireAdminApprovalForDeletion: '*bool!'
        requireExplicitConsent: '*bool!'
      request_type: PrivacySettingsRequest
    - name: GetConsentAuditLogs
      description: GetConsentAuditLogs handles GET /consent/audit-logs
      method: GET
      path: /audit
    - name: GenerateConsentReport
      description: GenerateConsentReport handles GET /consent/reports
      method: POST
      path: /reports
types:
    - name: DataExportRequest
      fields:
        completedAt: '*time.Time!'
        createdAt: time.Time!
        errorMessage: string!
        expiresAt: '*time.Time!'
        exportPath: string!
        exportSize: int64!
        exportUrl: string!
        format: string!
        id: xid.ID!
        includeSections: '[]string!'
        ipAddress: string!
        organizationId: string!
        status: string!
        updatedAt: time.Time!
        userId: string!
    - name: ConsentsResponse
      fields:
        consents: '!'
        count: int!
    - name: CookieConsentRequest
      fields:
        analytics: bool!
        bannerVersion: string!
        essential: bool!
        functional: bool!
        marketing: bool!
        personalization: bool!
        sessionId: string!
        thirdParty: bool!
    - name: DataDeletionRequestInput
      fields:
        deleteSections: '[]string!'
        reason: string!
    - name: ConsentCookieResponse
      fields:
        preferences: '!'
    - name: ConsentReportResponse
      fields:
        id: string!
    - name: ConsentRecord
      fields:
        consentType: string!
        createdAt: time.Time!
        expiresAt: '*time.Time!'
        granted: bool!
        grantedAt: time.Time!
        id: xid.ID!
        ipAddress: string!
        metadata: JSONBMap!
        organizationId: string!
        purpose: string!
        revokedAt: '*time.Time!'
        updatedAt: time.Time!
        userAgent: string!
        userId: string!
        version: string!
    - name: CookieConsent
      fields:
        analytics: bool!
        consentBannerVersion: string!
        createdAt: time.Time!
        essential: bool!
        expiresAt: time.Time!
        functional: bool!
        id: xid.ID!
        ipAddress: string!
        marketing: bool!
        organizationId: string!
        personalization: bool!
        sessionId: string!
        thirdParty: bool!
        updatedAt: time.Time!
        userAgent: string!
        userId: string!
    - name: ConsentAuditConfig
      fields:
        archiveInterval: time.Duration!
        archiveOldLogs: bool!
        enabled: bool!
        exportFormat: string!
        immutable: bool!
        logAllChanges: bool!
        logIpAddress: bool!
        logUserAgent: bool!
        retentionDays: int!
        signLogs: bool!
    - name: ErrorResponse
      fields:
        error: string!
        message: string!
    - name: ConsentStatusResponse
      fields:
        status: string!
    - name: Handler
      fields:
        "": '*Service'
    - name: ConsentSummary
      fields:
        consentsByType: '!'
        expiredConsents: int!
        grantedConsents: int!
        hasPendingDeletion: bool!
        hasPendingExport: bool!
        lastConsentUpdate: '*time.Time!'
        organizationId: string!
        pendingRenewals: int!
        revokedConsents: int!
        totalConsents: int!
        userId: string!
    - name: ConsentTypeStatus
      fields:
        expiresAt: '*time.Time!'
        granted: bool!
        grantedAt: time.Time!
        needsRenewal: bool!
        type: string!
        version: string!
    - name: PrivacySettingsRequest
      fields:
        allowDataPortability: '*bool!'
        anonymousConsentEnabled: '*bool!'
        autoDeleteAfterDays: '*int!'
        ccpaMode: '*bool!'
        consentRequired: '*bool!'
        contactEmail: string!
        contactPhone: string!
        cookieConsentEnabled: '*bool!'
        cookieConsentStyle: string!
        dataExportExpiryHours: '*int!'
        dataRetentionDays: '*int!'
        deletionGracePeriodDays: '*int!'
        dpoEmail: string!
        exportFormat: '[]string!'
        gdprMode: '*bool!'
        requireAdminApprovalForDeletion: '*bool!'
        requireExplicitConsent: '*bool!'
    - name: CreatePolicyRequest
      fields:
        consentType: string!
        content: string!
        description: string!
        metadata: '!'
        name: string!
        renewable: bool!
        required: bool!
        validityPeriod: '*int!'
        version: string!
    - name: ConsentReport
      fields:
        completedDeletions: int!
        consentRate: float64!
        consentsByType: '!'
        dataExportsThisPeriod: int!
        dpasActive: int!
        dpasExpiringSoon: int!
        organizationId: string!
        pendingDeletions: int!
        reportPeriodEnd: time.Time!
        reportPeriodStart: time.Time!
        totalUsers: int!
        usersWithConsent: int!
    - name: ConsentDeletionResponse
      fields:
        id: string!
        status: string!
    - name: ConsentPolicy
      fields:
        active: bool!
        consentType: string!
        content: string!
        createdAt: time.Time!
        createdBy: string!
        description: string!
        id: xid.ID!
        metadata: JSONBMap!
        name: string!
        organizationId: string!
        publishedAt: '*time.Time!'
        renewable: bool!
        required: bool!
        updatedAt: time.Time!
        validityPeriod: '*int!'
        version: string!
    - name: Config
      fields:
        audit: ConsentAuditConfig!
        ccpaEnabled: bool!
        cookieConsent: CookieConsentConfig!
        dashboard: ConsentDashboardConfig!
        dataDeletion: DataDeletionConfig!
        dataExport: DataExportConfig!
        enabled: bool!
        expiry: ConsentExpiryConfig!
        gdprEnabled: bool!
        notifications: ConsentNotificationsConfig!
    - name: DataExportConfig
      fields:
        allowedFormats: '[]string!'
        autoCleanup: bool!
        cleanupInterval: time.Duration!
        defaultFormat: string!
        enabled: bool!
        expiryHours: int!
        includeSections: '[]string!'
        maxExportSize: int64!
        maxRequests: int!
        requestPeriod: time.Duration!
        storagePath: string!
    - name: DataDeletionConfig
      fields:
        allowPartialDeletion: bool!
        archiveBeforeDeletion: bool!
        archivePath: string!
        autoProcessAfterGrace: bool!
        enabled: bool!
        gracePeriodDays: int!
        notifyBeforeDeletion: bool!
        preserveLegalData: bool!
        requireAdminApproval: bool!
        retentionExemptions: '[]string!'
    - name: CreateConsentRequest
      fields:
        consentType: string!
        expiresIn: '*int!'
        granted: bool!
        metadata: '!'
        purpose: string!
        userId: string!
        version: string!
    - name: UpdatePolicyRequest
      fields:
        active: '*bool!'
        content: string!
        description: string!
        metadata: '!'
        name: string!
        renewable: '*bool!'
        required: '*bool!'
        validityPeriod: '*int!'
    - name: DataExportRequestInput
      fields:
        format: string!
        includeSections: '[]string!'
    - name: ConsentAuditLogsResponse
      fields:
        audit_logs: '[]!'
    - name: PrivacySettings
      fields:
        allowDataPortability: bool!
        anonymousConsentEnabled: bool!
        autoDeleteAfterDays: int!
        ccpaMode: bool!
        consentRequired: bool!
        contactEmail: string!
        contactPhone: string!
        cookieConsentEnabled: bool!
        cookieConsentStyle: string!
        createdAt: time.Time!
        dataExportExpiryHours: int!
        dataRetentionDays: int!
        deletionGracePeriodDays: int!
        dpoEmail: string!
        exportFormat: '[]string!'
        gdprMode: bool!
        id: xid.ID!
        metadata: JSONBMap!
        organizationId: string!
        requireAdminApprovalForDeletion: bool!
        requireExplicitConsent: bool!
        updatedAt: time.Time!
    - name: ConsentStats
      fields:
        averageLifetime: int!
        expiredCount: int!
        grantRate: float64!
        grantedCount: int!
        revokedCount: int!
        totalConsents: int!
        type: string!
    - name: ConsentRecordResponse
      fields:
        id: string!
    - name: ConsentExportResponse
      fields:
        id: string!
        status: string!
    - name: ConsentExportFileResponse
      fields:
        content_type: string!
        data: '[]byte!'
    - name: ConsentAuditLog
      fields:
        action: string!
        consentId: string!
        consentType: string!
        createdAt: time.Time!
        id: xid.ID!
        ipAddress: string!
        newValue: JSONBMap!
        organizationId: string!
        previousValue: JSONBMap!
        purpose: string!
        reason: string!
        userAgent: string!
        userId: string!
    - name: MockRepository
      fields:
        "": ""
    - name: CookieConsentConfig
      fields:
        allowAnonymous: bool!
        bannerVersion: string!
        categories: '[]string!'
        defaultStyle: string!
        enabled: bool!
        requireExplicit: bool!
        validityPeriod: time.Duration!
    - name: ConsentNotificationsConfig
      fields:
        channels: '[]string!'
        enabled: bool!
        notifyDeletionApproved: bool!
        notifyDeletionComplete: bool!
        notifyDpoEmail: string!
        notifyExportReady: bool!
        notifyOnExpiry: bool!
        notifyOnGrant: bool!
        notifyOnRevoke: bool!
    - name: ConsentPolicyResponse
      fields:
        id: string!
    - name: DataProcessingAgreement
      fields:
        agreementType: string!
        content: string!
        createdAt: time.Time!
        digitalSignature: string!
        effectiveDate: time.Time!
        expiryDate: '*time.Time!'
        id: xid.ID!
        ipAddress: string!
        metadata: JSONBMap!
        organizationId: string!
        signedBy: string!
        signedByEmail: string!
        signedByName: string!
        signedByTitle: string!
        status: string!
        updatedAt: time.Time!
        version: string!
    - name: DataDeletionRequest
      fields:
        approvedAt: '*time.Time!'
        approvedBy: string!
        archivePath: string!
        completedAt: '*time.Time!'
        createdAt: time.Time!
        deleteSections: '[]string!'
        errorMessage: string!
        exemptionReason: string!
        id: xid.ID!
        ipAddress: string!
        organizationId: string!
        rejectedAt: '*time.Time!'
        requestReason: string!
        retentionExempt: bool!
        status: string!
        updatedAt: time.Time!
        userId: string!
    - name: Service
      fields:
        "": '*user.Service'
    - name: ConsentExpiryConfig
      fields:
        allowRenewal: bool!
        autoExpireCheck: bool!
        defaultValidityDays: int!
        enabled: bool!
        expireCheckInterval: time.Duration!
        renewalReminderDays: int!
        requireReConsent: bool!
    - name: ConsentDashboardConfig
      fields:
        enabled: bool!
        path: string!
        showAuditLog: bool!
        showConsentHistory: bool!
        showCookiePreferences: bool!
        showDataDeletion: bool!
        showDataExport: bool!
        showPolicies: bool!
    - name: UpdateConsentRequest
      fields:
        granted: '*bool!'
        metadata: '!'
        reason: string!
    - name: CreateDPARequest
      fields:
        agreementType: string!
        content: string!
        effectiveDate: time.Time!
        expiryDate: '*time.Time!'
        metadata: '!'
        signedByEmail: string!
        signedByName: string!
        signedByTitle: string!
        version: string!
    - name: Plugin
      fields:
        "": '*Service'
    - name: ConsentSettingsResponse
      fields:
        settings: '!'
    - name: BunRepository
      fields:
        "": '*bun.DB'
