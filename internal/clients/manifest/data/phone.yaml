plugin_id: phone
version: 1.0.0
routes:
    - name: SendCode
      description: SendCode handles sending of verification code via SMS
      method: POST
      path: /phone/send-code
      request:
        phone: string!
      request_type: SendCodeRequest
    - name: Verify
      description: Verify checks the code and creates a session on success
      method: POST
      path: /phone/verify
      request:
        code: string!
        email: string!
        phone: string!
        remember: bool!
      response:
        session: '*session.Session!'
        token: string!
        user: '*user.User!'
      request_type: VerifyRequest
      response_type: PhoneVerifyResponse
    - name: SignIn
      description: SignIn aliases to Verify for convenience
      method: POST
      path: /phone/signin
      request:
        code: string!
        email: string!
        phone: string!
        remember: bool!
      response:
        session: '*session.Session!'
        token: string!
        user: '*user.User!'
      request_type: VerifyRequest
      response_type: PhoneVerifyResponse
types:
    - name: VerifyRequest
      fields:
        code: string!
        email: string!
        phone: string!
        remember: bool!
    - name: Config
      fields:
        allowImplicitSignup: bool!
        codeLength: int!
        devExposeCode: bool!
        expiryMinutes: int!
        maxAttempts: int!
        rateLimit: RateLimitConfig!
        smsProvider: string!
    - name: RateLimitConfig
      fields:
        enabled: bool!
        redisAddr: string!
        redisDb: int!
        redisPassword: string!
        sendCodePerIp: RateLimitRule!
        sendCodePerPhone: RateLimitRule!
        useRedis: bool!
        verifyPerIp: RateLimitRule!
        verifyPerPhone: RateLimitRule!
    - name: RateLimitRule
      fields:
        max: int!
        window: time.Duration!
    - name: Handler
      fields:
        "": '*rl.Service'
    - name: SendCodeRequest
      fields:
        phone: string!
    - name: SendCodeResponse
      fields:
        dev_code: string!
        status: string!
    - name: PhoneVerifyResponse
      fields:
        session: '*session.Session!'
        token: string!
        user: '*user.User!'
    - name: Plugin
      fields:
        "": Config
    - name: Service
      fields:
        "": '*user.Service'
