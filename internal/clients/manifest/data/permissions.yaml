plugin_id: permissions
version: 1.0.0
routes:
    - name: MigrateAll
      description: MigrateAll migrates all RBAC policies to the permissions system
      method: POST
      path: /migrate/all
      request:
        dryRun: bool!
        preserveOriginal: bool!
      request_type: MigrateAllRequest
      response_type: ErrorResponse
    - name: MigrateRoles
      description: MigrateRoles migrates role-based permissions to policies
      method: POST
      path: /migrate/roles
      response_type: ErrorResponse
    - name: PreviewConversion
      description: PreviewConversion previews the conversion of an RBAC policy
      method: POST
      path: /migrate/preview
      request:
        actions: '[]string!'
        condition: string!
        resource: string!
        subject: string!
      request_type: PreviewConversionRequest
      response_type: ErrorResponse
types:
    - name: ValidatePolicyRequest
      fields:
        expression: string!
        resourceType: string!
    - name: TestPolicyRequest
      fields:
        actions: '[]string!'
        expression: string!
        resourceType: string!
        testCases: '[]TestCase!'
    - name: TestCaseResult
      fields:
        actual: bool!
        error: string!
        evaluationTimeMs: float64!
        expected: bool!
        name: string!
        passed: bool!
    - name: TemplateResponse
      fields:
        category: string!
        description: string!
        examples: '[]string!'
        expression: string!
        id: string!
        name: string!
        parameters: '[]core.TemplateParameter!'
    - name: TemplatesListResponse
      fields:
        categories: '[]string!'
        templates: '[]*TemplateResponse!'
        totalCount: int!
    - name: InstantiateTemplateRequest
      fields:
        actions: '[]string!'
        description: string!
        enabled: bool!
        name: string!
        namespaceId: string!
        parameters: '!'
        priority: int!
        resourceType: string!
    - name: MigrateRBACRequest
      fields:
        dryRun: bool!
        keepRbacPolicies: bool!
        namespaceId: string!
        validateEquivalence: bool!
    - name: ResourceTypeStats
      fields:
        allowRate: float64!
        avgLatencyMs: float64!
        evaluationCount: int64!
        resourceType: string!
    - name: NamespacesListResponse
      fields:
        namespaces: '[]*NamespaceResponse!'
        totalCount: int!
    - name: MigrationHandler
      fields:
        "": '*migration.RBACMigrationService'
    - name: PreviewConversionRequest
      fields:
        actions: '[]string!'
        condition: string!
        resource: string!
        subject: string!
    - name: GetMigrationStatusResponse
      fields:
        hasMigratedPolicies: bool!
        lastMigrationAt: string!
        migratedCount: int!
        pendingRbacPolicies: int!
    - name: ActionsListResponse
      fields:
        actions: '[]*ActionResponse!'
        totalCount: int!
    - name: NamespaceResponse
      fields:
        actionCount: int!
        appId: string!
        createdAt: time.Time!
        description: string!
        environmentId: string!
        id: string!
        inheritPlatform: bool!
        name: string!
        policyCount: int!
        resourceCount: int!
        templateId: '*string!'
        updatedAt: time.Time!
        userOrganizationId: '*string!'
    - name: TestCase
      fields:
        action: string!
        expected: bool!
        name: string!
        principal: '!'
        request: '!'
        resource: '!'
    - name: MigrationStatusResponse
      fields:
        appId: string!
        completedAt: '*time.Time!'
        environmentId: string!
        errors: '[]string!'
        failedCount: int!
        migratedCount: int!
        progress: float64!
        startedAt: time.Time!
        status: string!
        totalPolicies: int!
        userOrganizationId: '*string!'
        validationPassed: bool!
    - name: AnalyticsSummary
      fields:
        activePolicies: int!
        allowedCount: int64!
        avgLatencyMs: float64!
        cacheHitRate: float64!
        deniedCount: int64!
        topPolicies: '[]PolicyStats!'
        topResourceTypes: '[]ResourceTypeStats!'
        totalEvaluations: int64!
        totalPolicies: int!
    - name: MigrateAllRequest
      fields:
        dryRun: bool!
        preserveOriginal: bool!
    - name: MigrateAllResponse
      fields:
        completedAt: string!
        convertedPolicies: '[]PolicyPreviewResponse!'
        dryRun: bool!
        errors: '[]MigrationErrorResponse!'
        failedPolicies: int!
        migratedPolicies: int!
        skippedPolicies: int!
        startedAt: string!
        totalPolicies: int!
    - name: CreateResourceRequest
      fields:
        attributes: '[]ResourceAttributeRequest!'
        description: string!
        namespaceId: string!
        type: string!
    - name: ActionResponse
      fields:
        createdAt: time.Time!
        description: string!
        id: string!
        name: string!
        namespaceId: string!
    - name: CreateNamespaceRequest
      fields:
        description: string!
        inheritPlatform: bool!
        name: string!
        templateId: string!
    - name: GetMigrationStatusRequest
      fields: {}
    - name: UpdatePolicyRequest
      fields:
        actions: '[]string!'
        description: string!
        enabled: '*bool!'
        expression: string!
        name: string!
        priority: int!
        resourceType: string!
    - name: EvaluateRequest
      fields:
        action: string!
        context: '!'
        principal: '!'
        request: '!'
        resource: '!'
        resourceId: string!
        resourceType: string!
    - name: EvaluateResponse
      fields:
        allowed: bool!
        cacheHit: bool!
        error: string!
        evaluatedPolicies: int!
        evaluationTimeMs: float64!
        matchedPolicies: '[]string!'
        reason: string!
    - name: BatchEvaluateRequest
      fields:
        requests: '[]EvaluateRequest!'
    - name: PolicyStats
      fields:
        allowCount: int64!
        avgLatencyMs: float64!
        denyCount: int64!
        evaluationCount: int64!
        policyId: string!
        policyName: string!
    - name: MigrateRolesRequest
      fields:
        dryRun: bool!
    - name: ResourceAttributeRequest
      fields:
        default: '!'
        description: string!
        name: string!
        required: bool!
        type: string!
    - name: ResourcesListResponse
      fields:
        resources: '[]*ResourceResponse!'
        totalCount: int!
    - name: CreateActionRequest
      fields:
        description: string!
        name: string!
        namespaceId: string!
    - name: BatchEvaluateResponse
      fields:
        failureCount: int!
        results: '[]*BatchEvaluationResult!'
        successCount: int!
        totalEvaluations: int!
        totalTimeMs: float64!
    - name: AuditLogEntry
      fields:
        action: string!
        actorId: string!
        appId: string!
        environmentId: string!
        id: string!
        ipAddress: string!
        newValue: '!'
        oldValue: '!'
        resourceId: string!
        resourceType: string!
        timestamp: time.Time!
        userAgent: string!
        userOrganizationId: '*string!'
    - name: AuditLogResponse
      fields:
        entries: '[]*AuditLogEntry!'
        page: int!
        pageSize: int!
        totalCount: int!
    - name: MigrationErrorResponse
      fields:
        error: string!
        policyIndex: int!
        resource: string!
        subject: string!
    - name: PolicyResponse
      fields:
        actions: '[]string!'
        appId: string!
        createdAt: time.Time!
        createdBy: string!
        description: string!
        enabled: bool!
        environmentId: string!
        expression: string!
        id: string!
        name: string!
        namespaceId: string!
        priority: int!
        resourceType: string!
        updatedAt: time.Time!
        userOrganizationId: '*string!'
        version: int!
    - name: ResourceResponse
      fields:
        attributes: '[]core.ResourceAttribute!'
        createdAt: time.Time!
        description: string!
        id: string!
        namespaceId: string!
        type: string!
    - name: BatchEvaluationResult
      fields:
        action: string!
        allowed: bool!
        error: string!
        evaluationTimeMs: float64!
        index: int!
        policies: '[]string!'
        resourceId: string!
        resourceType: string!
    - name: ValidatePolicyResponse
      fields:
        complexity: int!
        error: string!
        errors: '[]string!'
        message: string!
        valid: bool!
        warnings: '[]string!'
    - name: TestPolicyResponse
      fields:
        error: string!
        failedCount: int!
        passed: bool!
        passedCount: int!
        results: '[]TestCaseResult!'
        total: int!
    - name: MigrationResponse
      fields:
        message: string!
        migrationId: string!
        startedAt: time.Time!
        status: string!
    - name: AnalyticsResponse
      fields:
        generatedAt: time.Time!
        summary: AnalyticsSummary!
        timeRange: '!'
    - name: PolicyPreviewResponse
      fields:
        actions: '[]string!'
        description: string!
        expression: string!
        name: string!
        resourceType: string!
    - name: CreatePolicyRequest
      fields:
        actions: '[]string!'
        description: string!
        enabled: bool!
        expression: string!
        name: string!
        namespaceId: string!
        priority: int!
        resourceType: string!
    - name: PoliciesListResponse
      fields:
        page: int!
        pageSize: int!
        policies: '[]*PolicyResponse!'
        totalCount: int!
    - name: UpdateNamespaceRequest
      fields:
        description: string!
        inheritPlatform: '*bool!'
        name: string!
    - name: PreviewConversionResponse
      fields:
        celExpression: string!
        error: string!
        policyName: string!
        resourceId: string!
        resourceType: string!
        success: bool!
