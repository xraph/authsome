plugin_id: backupauth
version: 1.0.0
routes:
    - name: StartRecovery
      description: StartRecovery handles POST /recovery/start
      method: POST
      path: /recovery/start
      request:
        deviceId: string!
        email: string!
        preferredMethod: RecoveryMethod!
        userId: string!
      response:
        session_id: string!
      request_type: StartRecoveryRequest
      response_type: BackupAuthRecoveryResponse
    - name: ContinueRecovery
      description: ContinueRecovery handles POST /recovery/continue
      method: POST
      path: /recovery/continue
      request:
        method: RecoveryMethod!
        sessionId: xid.ID!
      response:
        session_id: string!
      request_type: ContinueRecoveryRequest
      response_type: BackupAuthRecoveryResponse
    - name: CompleteRecovery
      description: CompleteRecovery handles POST /recovery/complete
      method: POST
      path: /recovery/complete
      request:
        sessionId: xid.ID!
      response:
        status: string!
      request_type: CompleteRecoveryRequest
      response_type: BackupAuthStatusResponse
    - name: CancelRecovery
      description: CancelRecovery handles POST /recovery/cancel
      method: POST
      path: /recovery/cancel
      request:
        reason: string!
        sessionId: xid.ID!
      response:
        status: string!
      request_type: CancelRecoveryRequest
      response_type: BackupAuthStatusResponse
    - name: GenerateRecoveryCodes
      description: GenerateRecoveryCodes handles POST /recovery-codes/generate
      method: POST
      path: /recovery-codes/generate
      request:
        count: int!
        format: string!
      response:
        codes: '[]string!'
      request_type: GenerateRecoveryCodesRequest
      response_type: BackupAuthCodesResponse
    - name: VerifyRecoveryCode
      description: VerifyRecoveryCode handles POST /recovery-codes/verify
      method: POST
      path: /recovery-codes/verify
      request:
        code: string!
        sessionId: xid.ID!
      response:
        status: string!
      request_type: VerifyRecoveryCodeRequest
      response_type: BackupAuthStatusResponse
    - name: SetupSecurityQuestions
      description: SetupSecurityQuestions handles POST /security-questions/setup
      method: POST
      path: /security-questions/setup
      request:
        questions: '[]SetupSecurityQuestionRequest!'
      response:
        status: string!
      request_type: SetupSecurityQuestionsRequest
      response_type: BackupAuthStatusResponse
    - name: GetSecurityQuestions
      description: GetSecurityQuestions handles POST /security-questions/get
      method: POST
      path: /security-questions/get
      request:
        sessionId: xid.ID!
      response:
        questions: '[]string!'
      request_type: GetSecurityQuestionsRequest
      response_type: BackupAuthQuestionsResponse
    - name: VerifySecurityAnswers
      description: VerifySecurityAnswers handles POST /security-questions/verify
      method: POST
      path: /security-questions/verify
      request:
        answers: '!'
        sessionId: xid.ID!
      response:
        status: string!
      request_type: VerifySecurityAnswersRequest
      response_type: BackupAuthStatusResponse
    - name: AddTrustedContact
      description: AddTrustedContact handles POST /trusted-contacts/add
      method: POST
      path: /trusted-contacts/add
      request:
        email: string!
        name: string!
        phone: string!
        relationship: string!
      response:
        id: string!
      request_type: AddTrustedContactRequest
      response_type: BackupAuthContactResponse
    - name: ListTrustedContacts
      description: ListTrustedContacts handles GET /trusted-contacts
      method: GET
      path: /trusted-contacts
      response:
        contacts: '[]!'
      response_type: BackupAuthContactsResponse
    - name: VerifyTrustedContact
      description: VerifyTrustedContact handles POST /trusted-contacts/verify
      method: POST
      path: /trusted-contacts/verify
      request:
        token: string!
      response:
        status: string!
      request_type: VerifyTrustedContactRequest
      response_type: BackupAuthStatusResponse
    - name: RequestTrustedContactVerification
      description: RequestTrustedContactVerification handles POST /trusted-contacts/request-verification
      method: POST
      path: /trusted-contacts/request-verification
      request:
        contactId: xid.ID!
        sessionId: xid.ID!
      response:
        status: string!
      request_type: RequestTrustedContactVerificationRequest
      response_type: BackupAuthStatusResponse
    - name: RemoveTrustedContact
      description: RemoveTrustedContact handles DELETE /trusted-contacts/:id
      method: DELETE
      path: /trusted-contacts/:id
      response:
        status: string!
      response_type: BackupAuthStatusResponse
    - name: SendVerificationCode
      description: SendVerificationCode handles POST /verification/send
      method: POST
      path: /verification/send
      request:
        method: RecoveryMethod!
        sessionId: xid.ID!
        target: string!
      response:
        status: string!
      request_type: SendVerificationCodeRequest
      response_type: BackupAuthStatusResponse
    - name: VerifyCode
      description: VerifyCode handles POST /verification/verify
      method: POST
      path: /verification/verify
      request:
        code: string!
        sessionId: xid.ID!
      response:
        status: string!
      request_type: VerifyCodeRequest
      response_type: BackupAuthStatusResponse
    - name: ScheduleVideoSession
      description: ScheduleVideoSession handles POST /video/schedule
      method: POST
      path: /video/schedule
      request:
        scheduledAt: time.Time!
        sessionId: xid.ID!
        timeZone: string!
      response:
        session_id: string!
      request_type: ScheduleVideoSessionRequest
      response_type: BackupAuthVideoResponse
    - name: StartVideoSession
      description: StartVideoSession handles POST /video/start
      method: POST
      path: /video/start
      request:
        videoSessionId: xid.ID!
      response:
        session_id: string!
      request_type: StartVideoSessionRequest
      response_type: BackupAuthVideoResponse
    - name: CompleteVideoSession
      description: CompleteVideoSession handles POST /video/complete (admin)
      method: POST
      path: /video/complete
      request:
        livenessPassed: bool!
        livenessScore: float64!
        notes: string!
        verificationResult: string!
        videoSessionId: xid.ID!
      response:
        status: string!
      request_type: CompleteVideoSessionRequest
      response_type: BackupAuthStatusResponse
    - name: UploadDocument
      description: UploadDocument handles POST /documents/upload
      method: POST
      path: /documents/upload
      request:
        backImage: string!
        documentType: string!
        frontImage: string!
        selfie: string!
        sessionId: xid.ID!
      response:
        id: string!
      request_type: UploadDocumentRequest
      response_type: BackupAuthDocumentResponse
    - name: GetDocumentVerification
      description: GetDocumentVerification handles GET /documents/:id
      method: GET
      path: /documents/:id
      response:
        id: string!
      response_type: BackupAuthDocumentResponse
    - name: ReviewDocument
      description: ReviewDocument handles POST /documents/:id/review (admin)
      method: POST
      path: /documents/:id/review
      request:
        approved: bool!
        documentId: xid.ID!
        notes: string!
        rejectionReason: string!
      response:
        status: string!
      request_type: ReviewDocumentRequest
      response_type: BackupAuthStatusResponse
    - name: ListRecoverySessions
      description: ListRecoverySessions handles GET /admin/sessions (admin)
      method: GET
      path: /admin/sessions
      response:
        sessions: '[]!'
      response_type: BackupAuthSessionsResponse
    - name: ApproveRecovery
      description: ApproveRecovery handles POST /admin/sessions/:id/approve (admin)
      method: POST
      path: /admin/sessions/:id/approve
      request:
        notes: string!
        sessionId: xid.ID!
      response:
        status: string!
      request_type: ApproveRecoveryRequest
      response_type: BackupAuthStatusResponse
    - name: RejectRecovery
      description: RejectRecovery handles POST /admin/sessions/:id/reject (admin)
      method: POST
      path: /admin/sessions/:id/reject
      request:
        notes: string!
        reason: string!
        sessionId: xid.ID!
      response:
        status: string!
      request_type: RejectRecoveryRequest
      response_type: BackupAuthStatusResponse
    - name: GetRecoveryStats
      description: GetRecoveryStats handles GET /admin/stats (admin)
      method: GET
      path: /admin/stats
      response:
        stats: '!'
      response_type: BackupAuthStatsResponse
    - name: GetRecoveryConfig
      description: GetRecoveryConfig handles GET /admin/config (admin)
      method: GET
      path: /admin/config
      response:
        config: '!'
      response_type: BackupAuthConfigResponse
    - name: UpdateRecoveryConfig
      description: UpdateRecoveryConfig handles PUT /admin/config (admin)
      method: PUT
      path: /admin/config
      request:
        enabledMethods: '[]RecoveryMethod!'
        minimumStepsRequired: int!
        requireAdminReview: bool!
        requireMultipleSteps: bool!
        riskScoreThreshold: float64!
      response:
        config: '!'
      request_type: UpdateRecoveryConfigRequest
      response_type: BackupAuthConfigResponse
    - name: HealthCheck
      description: HealthCheck handles GET /health
      method: GET
      path: /health
types:
    - name: SMSVerificationConfig
      fields:
        codeExpiry: time.Duration!
        codeLength: int!
        cooldownPeriod: time.Duration!
        enabled: bool!
        maxAttempts: int!
        maxSmsPerDay: int!
        messageTemplate: string!
        provider: string!
    - name: RiskAssessmentConfig
      fields:
        blockHighRisk: bool!
        enabled: bool!
        highRiskThreshold: float64!
        historyWeight: float64!
        lowRiskThreshold: float64!
        mediumRiskThreshold: float64!
        newDeviceWeight: float64!
        newIpWeight: float64!
        newLocationWeight: float64!
        requireReviewAbove: float64!
        velocityWeight: float64!
    - name: AuditConfig
      fields:
        archiveInterval: time.Duration!
        archiveOldLogs: bool!
        enabled: bool!
        immutableLogs: bool!
        logAllAttempts: bool!
        logDeviceInfo: bool!
        logFailed: bool!
        logIpAddress: bool!
        logSuccessful: bool!
        logUserAgent: bool!
        retentionDays: int!
    - name: CancelRecoveryRequest
      fields:
        reason: string!
        sessionId: xid.ID!
    - name: VerifyCodeResponse
      fields:
        attemptsLeft: int!
        message: string!
        valid: bool!
    - name: StartVideoSessionResponse
      fields:
        expiresAt: time.Time!
        message: string!
        sessionUrl: string!
        startedAt: time.Time!
        videoSessionId: xid.ID!
    - name: SecurityQuestionsConfig
      fields:
        allowCustomQuestions: bool!
        caseSensitive: bool!
        enabled: bool!
        forbidCommonAnswers: bool!
        lockoutDuration: time.Duration!
        maxAnswerLength: int!
        maxAttempts: int!
        minimumQuestions: int!
        predefinedQuestions: '[]string!'
        requireMinLength: int!
        requiredToRecover: int!
    - name: VideoVerificationConfig
      fields:
        enabled: bool!
        livenessThreshold: float64!
        minScheduleAdvance: time.Duration!
        provider: string!
        recordSessions: bool!
        recordingRetention: time.Duration!
        requireAdminReview: bool!
        requireLivenessCheck: bool!
        requireScheduling: bool!
        sessionDuration: time.Duration!
    - name: Handler
      fields:
        "": '*Service'
    - name: StartRecoveryRequest
      fields:
        deviceId: string!
        email: string!
        preferredMethod: RecoveryMethod!
        userId: string!
    - name: CompleteRecoveryRequest
      fields:
        sessionId: xid.ID!
    - name: VerifyTrustedContactResponse
      fields:
        contactId: xid.ID!
        message: string!
        verified: bool!
        verifiedAt: time.Time!
    - name: RequestTrustedContactVerificationResponse
      fields:
        contactId: xid.ID!
        contactName: string!
        expiresAt: time.Time!
        message: string!
        notifiedAt: time.Time!
    - name: VerifyCodeRequest
      fields:
        code: string!
        sessionId: xid.ID!
    - name: DocumentVerificationRequest
      fields:
        "": '[]byte'
    - name: NoOpNotificationProvider
      fields: {}
    - name: GetDocumentVerificationRequest
      fields:
        documentId: xid.ID!
    - name: ListRecoverySessionsResponse
      fields:
        page: int!
        pageSize: int!
        sessions: '[]RecoverySessionInfo!'
        totalCount: int!
    - name: GetRecoveryStatsResponse
      fields:
        adminReviewsRequired: int!
        averageRiskScore: float64!
        failedRecoveries: int!
        highRiskAttempts: int!
        methodStats: '!'
        pendingRecoveries: int!
        successRate: float64!
        successfulRecoveries: int!
        totalAttempts: int!
    - name: RecoveryAttemptLog
      fields:
        "": ""
    - name: RecoveryConfiguration
      fields:
        "": xid.ID
    - name: StartRecoveryResponse
      fields:
        availableMethods: '[]RecoveryMethod!'
        completedSteps: int!
        expiresAt: time.Time!
        requiredSteps: int!
        requiresReview: bool!
        riskScore: float64!
        sessionId: xid.ID!
        status: RecoveryStatus!
    - name: GenerateRecoveryCodesResponse
      fields:
        codes: '[]string!'
        count: int!
        generatedAt: time.Time!
        warning: string!
    - name: SetupSecurityQuestionRequest
      fields:
        answer: string!
        customText: string!
        questionId: int!
    - name: SetupSecurityQuestionsRequest
      fields:
        questions: '[]SetupSecurityQuestionRequest!'
    - name: VerifySecurityAnswersRequest
      fields:
        answers: '!'
        sessionId: xid.ID!
    - name: UploadDocumentRequest
      fields:
        backImage: string!
        documentType: string!
        frontImage: string!
        selfie: string!
        sessionId: xid.ID!
    - name: EmailVerificationConfig
      fields:
        codeExpiry: time.Duration!
        codeLength: int!
        emailTemplate: string!
        enabled: bool!
        fromAddress: string!
        fromName: string!
        maxAttempts: int!
        requireEmailProof: bool!
    - name: BackupAuthRecoveryResponse
      fields:
        session_id: string!
    - name: BackupAuthDocumentResponse
      fields:
        id: string!
    - name: VideoSessionInfo
      fields:
        "": bool
    - name: DocumentVerificationResult
      fields:
        "": float64
    - name: CompleteRecoveryResponse
      fields:
        completedAt: time.Time!
        message: string!
        sessionId: xid.ID!
        status: RecoveryStatus!
        token: string!
    - name: AddTrustedContactRequest
      fields:
        email: string!
        name: string!
        phone: string!
        relationship: string!
    - name: AddTrustedContactResponse
      fields:
        addedAt: time.Time!
        contactId: xid.ID!
        email: string!
        message: string!
        name: string!
        phone: string!
        verified: bool!
    - name: BackupAuthConfigResponse
      fields:
        config: '!'
    - name: RecoveryCodeUsage
      fields:
        "": string
    - name: SecurityQuestionInfo
      fields:
        id: xid.ID!
        isCustom: bool!
        questionId: int!
        questionText: string!
    - name: VerifyTrustedContactRequest
      fields:
        token: string!
    - name: TrustedContactInfo
      fields:
        active: bool!
        email: string!
        id: xid.ID!
        name: string!
        phone: string!
        relationship: string!
        verified: bool!
        verifiedAt: '*time.Time!'
    - name: StartVideoSessionRequest
      fields:
        videoSessionId: xid.ID!
    - name: CompleteVideoSessionRequest
      fields:
        livenessPassed: bool!
        livenessScore: float64!
        notes: string!
        verificationResult: string!
        videoSessionId: xid.ID!
    - name: RecoverySessionInfo
      fields:
        completedAt: '*time.Time!'
        createdAt: time.Time!
        currentStep: int!
        expiresAt: time.Time!
        id: xid.ID!
        method: RecoveryMethod!
        requiresReview: bool!
        riskScore: float64!
        status: RecoveryStatus!
        totalSteps: int!
        userEmail: string!
        userId: xid.ID!
    - name: RateLimitingConfig
      fields:
        enabled: bool!
        exponentialBackoff: bool!
        ipCooldownPeriod: time.Duration!
        lockoutAfterAttempts: int!
        lockoutDuration: time.Duration!
        maxAttemptsPerDay: int!
        maxAttemptsPerHour: int!
        maxAttemptsPerIp: int!
    - name: BackupAuthQuestionsResponse
      fields:
        questions: '[]string!'
    - name: GetSecurityQuestionsRequest
      fields:
        sessionId: xid.ID!
    - name: SendVerificationCodeResponse
      fields:
        expiresAt: time.Time!
        maskedTarget: string!
        message: string!
        sent: bool!
    - name: CompleteVideoSessionResponse
      fields:
        completedAt: time.Time!
        message: string!
        result: string!
        videoSessionId: xid.ID!
    - name: GetDocumentVerificationResponse
      fields:
        confidenceScore: float64!
        documentId: xid.ID!
        message: string!
        rejectionReason: string!
        status: string!
        verifiedAt: '*time.Time!'
    - name: ListRecoverySessionsRequest
      fields:
        organizationId: string!
        page: int!
        pageSize: int!
        requiresReview: bool!
        status: RecoveryStatus!
    - name: RejectRecoveryResponse
      fields:
        message: string!
        reason: string!
        rejected: bool!
        rejectedAt: time.Time!
        sessionId: xid.ID!
    - name: RecoveryCodesConfig
      fields:
        allowDownload: bool!
        allowPrint: bool!
        autoRegenerate: bool!
        codeCount: int!
        codeLength: int!
        enabled: bool!
        format: string!
        regenerateCount: int!
    - name: BackupAuthContactResponse
      fields:
        id: string!
    - name: GenerateRecoveryCodesRequest
      fields:
        count: int!
        format: string!
    - name: VerifyRecoveryCodeRequest
      fields:
        code: string!
        sessionId: xid.ID!
    - name: UpdateRecoveryConfigRequest
      fields:
        enabledMethods: '[]RecoveryMethod!'
        minimumStepsRequired: int!
        requireAdminReview: bool!
        requireMultipleSteps: bool!
        riskScoreThreshold: float64!
    - name: BackupAuthVideoResponse
      fields:
        session_id: string!
    - name: VideoVerificationSession
      fields:
        "": string
    - name: ContinueRecoveryRequest
      fields:
        method: RecoveryMethod!
        sessionId: xid.ID!
    - name: RequestTrustedContactVerificationRequest
      fields:
        contactId: xid.ID!
        sessionId: xid.ID!
    - name: HealthCheckResponse
      fields:
        enabledMethods: '[]RecoveryMethod!'
        healthy: bool!
        message: string!
        providersStatus: '!'
        version: string!
    - name: SuccessResponse
      fields:
        message: string!
        success: bool!
    - name: BackupAuthStatsResponse
      fields:
        stats: '!'
    - name: NoOpEmailProvider
      fields: {}
    - name: NoOpVideoProvider
      fields: {}
    - name: NoOpDocumentProvider
      fields: {}
    - name: SendVerificationCodeRequest
      fields:
        method: RecoveryMethod!
        sessionId: xid.ID!
        target: string!
    - name: ScheduleVideoSessionRequest
      fields:
        scheduledAt: time.Time!
        sessionId: xid.ID!
        timeZone: string!
    - name: Config
      fields:
        audit: AuditConfig!
        documentVerification: DocumentVerificationConfig!
        emailVerification: EmailVerificationConfig!
        enabled: bool!
        multiStepRecovery: MultiStepRecoveryConfig!
        notifications: NotificationsConfig!
        rateLimiting: RateLimitingConfig!
        recoveryCodes: RecoveryCodesConfig!
        riskAssessment: RiskAssessmentConfig!
        securityQuestions: SecurityQuestionsConfig!
        smsVerification: SMSVerificationConfig!
        trustedContacts: TrustedContactsConfig!
        videoVerification: VideoVerificationConfig!
    - name: Plugin
      fields:
        "": '*bun.DB'
    - name: BackupAuthStatusResponse
      fields:
        status: string!
    - name: NoOpSMSProvider
      fields: {}
    - name: BunRepository
      fields:
        "": '*bun.DB'
    - name: SecurityQuestion
      fields:
        "": '*xid.ID'
    - name: RemoveTrustedContactRequest
      fields:
        contactId: xid.ID!
    - name: ErrorResponse
      fields:
        code: string!
        details: '!'
        error: string!
        message: string!
    - name: TrustedContactsConfig
      fields:
        allowEmailContacts: bool!
        allowPhoneContacts: bool!
        cooldownPeriod: time.Duration!
        enabled: bool!
        maxNotificationsPerDay: int!
        maximumContacts: int!
        minimumContacts: int!
        requireVerification: bool!
        requiredToRecover: int!
        verificationExpiry: time.Duration!
    - name: TrustedContact
      fields:
        "": string
    - name: ListTrustedContactsResponse
      fields:
        contacts: '[]TrustedContactInfo!'
        count: int!
    - name: ScheduleVideoSessionResponse
      fields:
        instructions: string!
        joinUrl: string!
        message: string!
        scheduledAt: time.Time!
        videoSessionId: xid.ID!
    - name: ApproveRecoveryRequest
      fields:
        notes: string!
        sessionId: xid.ID!
    - name: GetRecoveryStatsRequest
      fields:
        endDate: time.Time!
        organizationId: string!
        startDate: time.Time!
    - name: DocumentVerificationConfig
      fields:
        acceptedDocuments: '[]string!'
        enabled: bool!
        encryptAtRest: bool!
        encryptionKey: string!
        minConfidenceScore: float64!
        provider: string!
        requireBothSides: bool!
        requireManualReview: bool!
        requireSelfie: bool!
        retentionPeriod: time.Duration!
        storagePath: string!
        storageProvider: string!
    - name: BackupAuthContactsResponse
      fields:
        contacts: '[]!'
    - name: RecoverySession
      fields:
        "": RecoveryStatus
    - name: DocumentVerification
      fields:
        "": string
    - name: UploadDocumentResponse
      fields:
        documentId: xid.ID!
        message: string!
        processingTime: string!
        status: string!
        uploadedAt: time.Time!
    - name: ReviewDocumentRequest
      fields:
        approved: bool!
        documentId: xid.ID!
        notes: string!
        rejectionReason: string!
    - name: ApproveRecoveryResponse
      fields:
        approved: bool!
        approvedAt: time.Time!
        message: string!
        sessionId: xid.ID!
    - name: RejectRecoveryRequest
      fields:
        notes: string!
        reason: string!
        sessionId: xid.ID!
    - name: NotificationsConfig
      fields:
        channels: '[]string!'
        enabled: bool!
        notifyAdminOnHighRisk: bool!
        notifyAdminOnReviewNeeded: bool!
        notifyOnRecoveryComplete: bool!
        notifyOnRecoveryFailed: bool!
        notifyOnRecoveryStart: bool!
        securityOfficerEmail: string!
    - name: BackupAuthCodesResponse
      fields:
        codes: '[]string!'
    - name: DefaultProviderRegistry
      fields:
        "": EmailProvider
    - name: VerifyRecoveryCodeResponse
      fields:
        message: string!
        remainingCodes: int!
        valid: bool!
    - name: SetupSecurityQuestionsResponse
      fields:
        count: int!
        message: string!
        setupAt: time.Time!
    - name: VerifySecurityAnswersResponse
      fields:
        attemptsLeft: int!
        correctAnswers: int!
        message: string!
        requiredAnswers: int!
        valid: bool!
    - name: GetRecoveryConfigResponse
      fields:
        enabledMethods: '[]RecoveryMethod!'
        minimumStepsRequired: int!
        requireAdminReview: bool!
        requireMultipleSteps: bool!
        riskScoreThreshold: float64!
    - name: MultiStepRecoveryConfig
      fields:
        allowStepSkip: bool!
        allowUserChoice: bool!
        enabled: bool!
        highRiskSteps: '[]RecoveryMethod!'
        lowRiskSteps: '[]RecoveryMethod!'
        mediumRiskSteps: '[]RecoveryMethod!'
        minimumSteps: int!
        requireAdminApproval: bool!
        sessionExpiry: time.Duration!
    - name: Service
      fields:
        "": ProviderRegistry
    - name: ContinueRecoveryResponse
      fields:
        currentStep: int!
        data: '!'
        expiresAt: time.Time!
        instructions: string!
        method: RecoveryMethod!
        sessionId: xid.ID!
        totalSteps: int!
    - name: BackupAuthSessionsResponse
      fields:
        sessions: '[]!'
    - name: VideoSessionResult
      fields:
        "": string
    - name: GetSecurityQuestionsResponse
      fields:
        questions: '[]SecurityQuestionInfo!'
