plugin_id: sso
version: 1.0.0
routes:
    - name: RegisterProvider
      description: RegisterProvider registers a new SSO provider (SAML or OIDC)
      method: POST
      path: /sso/provider/register
      request:
        attributeMapping: '!'
        domain: string!
        oidcClientID: string!
        oidcClientSecret: string!
        oidcIssuer: string!
        oidcRedirectURI: string!
        providerId: string!
        samlCert: string!
        samlEntryPoint: string!
        samlIssuer: string!
        type: string!
      response:
        providerId: string!
        status: string!
        type: string!
      request_type: RegisterProviderRequest
      response_type: ProviderRegisteredResponse
    - name: SAMLSPMetadata
      description: SAMLSPMetadata returns Service Provider metadata
      method: GET
      path: /sso/saml2/sp/metadata
      response:
        metadata: string!
      response_type: MetadataResponse
    - name: SAMLLogin
      description: SAMLLogin initiates SAML authentication by generating AuthnRequest
      method: POST
      path: /sso/saml2/login/:providerId
      request:
        relayState: string!
      response:
        providerId: string!
        redirectUrl: string!
        requestId: string!
      request_type: SAMLLoginRequest
      response_type: SAMLLoginResponse
    - name: SAMLCallback
      description: SAMLCallback handles SAML response callback and provisions user
      method: POST
      path: /sso/saml2/callback/:providerId
      response:
        session: '*session.Session!'
        token: string!
        user: '*user.User!'
      response_type: SSOAuthResponse
    - name: OIDCLogin
      description: OIDCLogin initiates OIDC authentication flow with PKCE
      method: POST
      path: /sso/oidc/login/:providerId
      request:
        nonce: string!
        redirectUri: string!
        scope: string!
        state: string!
      response:
        authUrl: string!
        nonce: string!
        providerId: string!
        state: string!
      request_type: OIDCLoginRequest
      response_type: OIDCLoginResponse
    - name: OIDCCallback
      description: OIDCCallback handles OIDC callback and provisions user
      method: GET
      path: /sso/oidc/callback/:providerId
      response:
        session: '*session.Session!'
        token: string!
        user: '*user.User!'
      response_type: SSOAuthResponse
types:
    - name: ProviderRegisteredResponse
      fields:
        providerId: string!
        status: string!
        type: string!
    - name: SAMLLoginResponse
      fields:
        providerId: string!
        redirectUrl: string!
        requestId: string!
    - name: ProviderInfo
      fields:
        createdAt: string!
        domain: string!
        providerId: string!
        type: string!
    - name: Service
      fields:
        "": Config
    - name: StateStore
      fields:
        "": ""
    - name: DiscoverProviderRequest
      fields:
        email: string!
    - name: SSOAuthResponse
      fields:
        session: '*session.Session!'
        token: string!
        user: '*user.User!'
    - name: OIDCLoginResponse
      fields:
        authUrl: string!
        nonce: string!
        providerId: string!
        state: string!
    - name: MetadataResponse
      fields:
        metadata: string!
    - name: Handler
      fields:
        "": forge.Logger
    - name: MockUserService
      fields: {}
    - name: MockSessionService
      fields: {}
    - name: RedisStateStore
      fields: {}
    - name: OIDCLoginRequest
      fields:
        nonce: string!
        redirectUri: string!
        scope: string!
        state: string!
    - name: Config
      fields:
        allowOIDC: bool!
        allowSAML: bool!
        attributeMapping: '!'
        autoProvision: bool!
        defaultRole: string!
        oidcRedirectURL: string!
        requireEncryption: bool!
        samlACS: string!
        samlMetadataURL: string!
        updateAttributes: bool!
    - name: SAMLLoginRequest
      fields:
        relayState: string!
    - name: ProviderDiscoveredResponse
      fields:
        found: bool!
        providerId: string!
        type: string!
    - name: ProviderListResponse
      fields:
        providers: '[]ProviderInfo!'
        total: int!
    - name: ProviderDetailResponse
      fields:
        attributeMapping: '!'
        createdAt: string!
        domain: string!
        hasSamlCert: bool!
        oidcClientID: string!
        oidcIssuer: string!
        oidcRedirectURI: string!
        providerId: string!
        samlEntryPoint: string!
        samlIssuer: string!
        type: string!
        updatedAt: string!
    - name: Plugin
      fields:
        "": Config
    - name: OIDCState
      fields:
        "": time.Time
    - name: RegisterProviderRequest
      fields:
        attributeMapping: '!'
        domain: string!
        oidcClientID: string!
        oidcClientSecret: string!
        oidcIssuer: string!
        oidcRedirectURI: string!
        providerId: string!
        samlCert: string!
        samlEntryPoint: string!
        samlIssuer: string!
        type: string!
